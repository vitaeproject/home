{"ast":null,"code":"'use strict';\n\nvar promisify = require('promisify-es6');\n\nvar dagPB = require('ipld-dag-pb');\n\nvar DAGNode = dagPB.DAGNode;\n\nvar Unixfs = require('ipfs-unixfs');\n\nmodule.exports = function (send) {\n  return promisify(function (template, callback) {\n    if (typeof template === 'function') {\n      callback = template;\n      template = undefined;\n    }\n\n    send({\n      path: 'object/new',\n      args: template\n    }, function (err, result) {\n      if (err) {\n        return callback(err);\n      }\n\n      var data;\n\n      if (template) {\n        if (template !== 'unixfs-dir') {\n          return callback(new Error('unkown template: ' + template));\n        }\n\n        data = new Unixfs('directory').marshal();\n      } else {\n        data = Buffer.alloc(0);\n      }\n\n      DAGNode.create(data, function (err, node) {\n        if (err) {\n          return callback(err);\n        }\n\n        if (node.toJSON().multihash !== result.Hash) {\n          return callback(new Error('multihashes do not match'));\n        }\n\n        callback(null, node);\n      });\n    });\n  });\n};","map":null,"metadata":{},"sourceType":"script"}